{"version":3,"sources":["app.js","canvas.js"],"names":["clearAll","node","document","getElementById","lastChild","deleteCanvas","addCanvas","debounce","func","timer","event","clearTimeout","setTimeout","httpGet","theUrl","xmlHttp","XMLHttpRequest","open","send","responseText","startSocket","hash","socket","io","connect","room","on","emit","onDrawingEvent","history","JSON","parse","data","length","createCanvasByData","sharePano","link","s4","Math","floor","random","toString","substring","href","window","location","init","wW","innerWidth","wH","innerHeight","remove","nav","querySelector","repeatOften","requestAnimationFrame","mapData","canvas","isHistory","forEach","item","idx","drawCanvas","createImage","toDataURL","canvasInit","width","height","dataList","concat","getContext","ctx","lineWidth","lineJoin","lineCap","classList","add","drawing","moveOnCanvas","e","options","isDraw","source","mousePress","intervalDraw","clearInterval","res","touches","pageX","pageY","push","mouseDown","which","setInterval","SPEED","mouseUp","endLine","removeEventListener","this","restore","addEventListener","layers","num","canvasId","substr","opacity","color","type","sizeKoof","setColor","colorSelect","value","setOpacity","slider","setLength","setSource","selectObject","setDraw","setType","lineType","val","disabled","wrapper","createElement","setAttribute","appendChild","replace","createNew","src","nodes","querySelectorAll","activeNode","lastNode","n","splice","evtobj","keyCode","ctrlKey","round","float","sign","lineSize","mX","mY","point","x","y","signX","signY","line","sX","sY","eX","eY","radius","beginPath","moveTo","lineTo","cX1","cY1","quadraticCurveTo","arc","PI","getColor","fillStyle","fill","strokeStyle","stroke"],"mappings":"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","file":"main-3a0e.js","sourcesContent":["var layers = [];\nvar num = 0;\nvar canvasId = \"#canvas\";\nvar wW = window.innerWidth;\nvar wH = window.innerHeight;\nvar nav = document.querySelector(\"nav\");\nvar intervalDraw;\nvar socket;\nvar hash = window.location.hash.substr(1);\n\nconst SPEED = 1;\nconst options = {\n  opacity: 0.6,\n  length: 120,\n  color: '0',\n  source: '1',\n  type: '3',\n  isDraw: true,\n  mousePress: false,\n  endLine: null\n};\noptions.sizeKoof = options.type === '3' ? 5 : 2;\n\n\nconst setColor = function(colorSelect) {\n  options.color = colorSelect.value;\n};\n\nconst setOpacity = function (slider) {\n  options.opacity = slider.value;\n};\n\nconst setLength = function (slider) {\n  options.length = slider.value;\n};\n\nconst setSource = function(selectObject) {\n  clearInterval(intervalDraw);\n\n  options.source = selectObject.value;\n  options.endLine = null;\n\n  if (options.source == '0') {\n    nav.classList.remove('mouse');\n    setDraw(false);\n  } else {\n    nav.classList.add('mouse');\n    setDraw(true);\n  }\n};\n\nconst setType = function(lineType) {\n  options.type = lineType.value;\n  options.endLine = null;\n  options.sizeKoof = (lineType.value === '3') ? 5 : 2;\n};\n\nconst setDraw = function(val) {\n  options.isDraw = val;\n  const canvas = document.getElementById(layers[layers.length - 1]);\n\n  if (document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = val;\n  }\n\n  if (val) {\n    nav.classList.add('active')\n\n    if (options.source === '0') {\n      intervalDraw = setInterval(function() {\n        drawCanvas(canvas)\n      }, Math.floor(Math.random() * (SPEED - (SPEED / 2) + (SPEED / 2)) * 100) / 100)\n    }\n  } else {\n    nav.classList.remove('active')\n    if (intervalDraw) {\n      clearInterval(intervalDraw);\n    }\n\n    if (hash) {\n      socket.emit('drawing', canvas.toDataURL());\n    }\n\n    addCanvas();\n  }\n};\n\nvar addCanvas = function() {\n  var wrapper = document.querySelector(\"#wrapper\");\n  var node = document.createElement(\"canvas\");\n\n  canvasId = \"canvas\" + num;\n  node.setAttribute(\"id\", canvasId);\n  wrapper.appendChild(node);\n\n  var canvas = document.getElementById(canvasId);\n  layers.push(canvasId);\n\n  if (layers.length > 1 && document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = false;\n  }\n  \n  canvasInit(canvas)\n\n  num++;\n};\n\nvar createCanvasByData = function(data, isHistory) {\n  var wrapper = document.querySelector(\"#wrapper\");\n  var node = document.createElement(\"canvas\");\n  \n  canvasId = \"canvas\" + num;\n  node.setAttribute(\"id\", canvasId);\n  wrapper.appendChild(node);\n  \n  var canvas = document.getElementById(canvasId);\n  layers.push(canvasId);\n  \n  if (layers.length > 1 && document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = false;\n  }\n  \n  canvasInit(canvas, data, isHistory)\n  \n  num++;\n};\n\nvar createImage = function(data, replace, createNew) {\n  var wrapper = document.querySelector(\"#wrapper\");\n  var node = document.createElement(\"img\");\n  node.src = data;\n\n  if (replace) {\n    const nodes = wrapper.querySelectorAll('canvas:not(.active)');\n    const activeNode = wrapper.querySelector('canvas.active');\n    var lastNode = nodes[nodes.length- 1];\n    if (lastNode) {\n      lastNode.remove();\n    } else {\n      activeNode.remove();\n    }\n  }\n  wrapper.appendChild(node);\n\n  if (createNew) {\n    addCanvas();\n  }\n};\n\nvar deleteCanvas = function(n) {\n  var node = document.getElementById(layers[layers.length - 2 + (n ? n : 0)]);\n  node.remove();\n\n  layers.splice(layers.length - 2 + (n ? n : 0), 1);\n\n  if (layers.length < 2 && document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = true;\n  }\n\n  if(layers.length === 0) {\n    addCanvas();\n  }\n};\n\nfunction clearAll() {\n  var node = document.getElementById('wrapper');\n  while (node.lastChild) {\n    deleteCanvas()\n  }\n\n  addCanvas();\n}\n\nwindow.addEventListener('keydown', function(e) {\n  var evtobj = window.event ? event : e\n\n  if (evtobj.keyCode == 90 && evtobj.ctrlKey) {\n\n    if (layers.length > 1) {\n      deleteCanvas();\n    }\n  }\n});\n\nfunction debounce(func) {\n  var timer;\n\n  return function(event) {\n    if (timer) clearTimeout(timer);\n\n    timer = setTimeout(func, 300, event);\n  };\n}\n\nwindow.addEventListener(\"resize\", debounce(function() {\n  wW = window.innerWidth;\n  wH = window.innerHeight;\n\n  deleteCanvas(1);\n  addCanvas();\n}));\n\nvar onDrawingEvent = function(data) {\n  createCanvasByData(data, false);\n};\n\nfunction httpGet(theUrl) {\n  var xmlHttp = new XMLHttpRequest();\n  xmlHttp.open( \"GET\", theUrl, false ); // false for synchronous request\n  xmlHttp.send( null );\n  return xmlHttp.responseText;\n}\n\nfunction startSocket(hash) {\n  socket = io.connect();\n  var room = 'room-' + hash;\n\n  socket.on('connect', function() {\n    socket.emit('room', room);\n  });\n\n  socket.on('drawing', onDrawingEvent);\n\n  const history = JSON.parse(httpGet('/history?room=' + room)).data;\n  \n  if (history && history.length > 0) {\n    // history.forEach(item => {\n      createCanvasByData(history, true);\n    // })\n  }\n}\n\nfunction sharePano(link) {\n  function guid() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + s4();\n  }\n\n  const hash = guid();\n\n  link.href = window.location + '#' + hash\n}\n\nfunction init() {\n  wW = window.innerWidth;\n  wH = window.innerHeight;\n\n  if (hash) {\n    document.getElementById('clearBtn').remove();\n    document.getElementById('undoBtn').remove();\n    document.getElementById('shareBtn').remove();\n    startSocket(hash);\n  }\n\n  nav = document.querySelector(\"nav\");\n\n  addCanvas();\n}\n","const opacity = function(opacity) {\n  return opacity + Math.round(Math.random() * 0.4);\n};\n\nconst color = function(color) {\n  return (color === options.color) ? 220 : Math.round(Math.random() * ((options.color > 0 ? 100 : 150) - 10) + 10);\n};\n\nconst float = function () {\n  return Math.floor((Math.random() * 10) * (Math.random() < 0.5 ? -1 : 1));\n};\n\nconst sign = function() {\n  return (Math.random() < 0.5 ? -1 : 1);\n};\n\nconst lineSize = function() {\n  return Math.floor((Math.random() * options.length / options.sizeKoof));\n};\n\nfunction repeatOften(func) {\n  func\n  requestAnimationFrame(repeatOften);\n}\n\nconst drawCanvas = function(canvas, mX, mY, data) {\n  const ctx = canvas.getContext(\"2d\");\n  const point = data ? data.point : {\n    x: (mX && mY) ? mX + float() : Math.floor(Math.random() * (wW) * 100) / 100,\n    y: (mX && mY) ? mY + float() : Math.floor(Math.random() * (wH) * 100) / 100,\n  };\n  const signX = data ? data.signY : sign();\n  const signY = data ? data.signY : sign();\n  const line = data ? data.line : {\n    sX: point.x + lineSize() * signX,\n    sY: point.y + lineSize() * signY,\n    eX: point.x + lineSize() * -signX,\n    eY: point.y + lineSize() * -signY,\n  };\n  const type = data ? data.type : options.type;\n  const radius = data ? data.radius : lineSize(10);\n\n  ctx.beginPath();\n  ctx.moveTo(options.endLine ? options.endLine.x : line.sX, options.endLine ? options.endLine.y : line.sY);\n\n  if (type === '1') {\n    ctx.lineTo(line.eX, line.eY);\n  } else if (type === '2') {\n    line.cX1 = (line.sX + line.eX)/2 + Math.random() * 10 * signX;\n    line.cY1 = (line.sY + line.eY)/2 + Math.random() * 10 * -signY;\n\n    ctx.quadraticCurveTo(line.cX1,line.cY1,line.eX,line.eY);\n\n    options.endLine = {\n      x: line.eX,\n      y: line.eY,\n    }\n  } else {\n    ctx.arc(line.sX,line.sY,radius,0,2*Math.PI);\n  }\n\n  const getColor = data ? data.color : 'rgba(' + color('1') + ', ' + color('2') + ', ' + color('3') + ', ' + (opacity(options.opacity)) + ')';\n\n  if (type === '3') {\n    ctx.fillStyle = getColor;\n    ctx.fill()\n  } else {\n    ctx.strokeStyle = getColor;\n    ctx.stroke();\n  }\n\n  if (data) return null;\n\n  return {\n    type: options.type,\n    point,\n    line,\n    signX,\n    signY,\n    radius,\n    color: getColor\n  };\n};\n\nfunction mapData(canvas, data, isHistory) {\n  data.forEach((item, idx) => {\n    if (isHistory) {\n      drawCanvas(canvas, null, null, item)\n\n      if (idx === data.length -1) {\n        createImage(canvas.toDataURL(), true);\n      }\n    } else {\n      repeatOften(setTimeout(function(){\n        drawCanvas(canvas, null, null, item)\n\n        if (idx === data.length -1) {\n          createImage(canvas.toDataURL(), true);\n        }\n      }, 1000/60 * idx));\n    }\n  })\n}\n\nfunction canvasInit(canvas, data, isHistory) {\n  canvas.width = wW;\n  canvas.height = wH;\n  var dataList = [];\n\n  if (isHistory) {\n    data.forEach(item => {\n      dataList = dataList.concat(item)\n    });\n  }\n\n  if (canvas.getContext) {\n    var ctx = canvas.getContext(\"2d\");\n\n    ctx.lineWidth = 1;\n    ctx.lineJoin = ctx.lineCap = 'round';\n\n    if (data) {\n      mapData(canvas, isHistory ? dataList : data, isHistory);\n    } else {\n      canvas.classList.add('active');\n\n      const drawing = [];\n\n      canvas.moveOnCanvas = function(e) {\n        if (options.isDraw && (options.source === '2' || (options.source === '1' && canvas.mousePress))) {\n          if (intervalDraw) {\n            clearInterval(intervalDraw);\n          }\n          const res = drawCanvas(canvas, e.touches ? e.touches[0].pageX : e.pageX, e.touches ? e.touches[0].pageY : e.pageY)\n          if (res) {\n            drawing.push(res);\n          }\n        }\n      };\n\n      canvas.mouseDown = function(e) {\n        if (e.which === 1) {\n          canvas.mousePress = true;\n          if (options.isDraw && options.source === '1') {\n            intervalDraw = setInterval(function() {\n              const res = drawCanvas(canvas, e.touches ? e.touches[0].pageX : e.pageX, e.touches ? e.touches[0].pageY : e.pageY)\n              if (res) {\n                drawing.push(res);\n              }\n            }, Math.floor(Math.random() * (SPEED - (SPEED / 2) + (SPEED / 2)) * 100) / 5)\n          }\n        }\n      };\n      canvas.mouseUp = function() {\n        if (options.source === '2' || (options.source === '1')) {\n          options.endLine = null;\n          if (intervalDraw) {\n            clearInterval(intervalDraw);\n          }\n\n          if (canvas.mousePress) {\n            if (hash) {\n              socket.emit('drawing', drawing);\n            }\n\n            canvas.removeEventListener('mousedown', this, false);\n            canvas.removeEventListener('touchstart', this, false);\n            canvas.removeEventListener('mousemove', this, false);\n            canvas.removeEventListener('touchmove', this, false);\n            canvas.removeEventListener('mouseup', this, false);\n            canvas.removeEventListener('touchend', this, false);\n\n            createImage(canvas.toDataURL(), true, true);\n          }\n        }\n\n        canvas.mousePress = false;\n        ctx.restore();\n      };\n\n      canvas.addEventListener('mousedown', canvas.mouseDown);\n      canvas.addEventListener('touchstart', canvas.mouseDown);\n      canvas.addEventListener('mousemove', canvas.moveOnCanvas);\n      canvas.addEventListener('touchmove', canvas.moveOnCanvas);\n      canvas.addEventListener('mouseup', canvas.mouseUp);\n      canvas.addEventListener('touchend', canvas.mouseUp);\n    }\n  }\n}\n"]}