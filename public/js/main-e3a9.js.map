{"version":3,"sources":["app.js","canvas.js"],"names":["clearAll","document","getElementById","querySelectorAll","forEach","e","parentNode","removeChild","debounce","func","timer","event","clearTimeout","setTimeout","httpGet","theUrl","xmlHttp","XMLHttpRequest","open","send","responseText","startSocket","hash","socket","io","connect","room","on","emit","onDrawingEvent","history","JSON","parse","data","length","createCanvasByData","sharePano","link","s4","Math","floor","random","toString","substring","href","window","location","init","wW","innerWidth","wH","innerHeight","remove","nav","querySelector","addCanvas","repeatOften","requestAnimationFrame","mapData","canvas","isHistory","item","idx","drawCanvas","createImage","toDataURL","canvasInit","width","height","dataList","concat","getContext","ctx","lineWidth","lineJoin","lineCap","classList","add","drawing","moveOnCanvas","options","isDraw","source","mousePress","intervalDraw","clearInterval","res","touches","pageX","pageY","push","mouseDown","which","setInterval","SPEED","mouseUp","endLine","removeEventListener","this","restore","addEventListener","layers","num","canvasId","substr","opacity","color","type","sizeKoof","setColor","colorSelect","value","setOpacity","slider","setLength","setSource","selectObject","setDraw","setType","lineType","val","disabled","wrapper","node","createElement","setAttribute","appendChild","isImport","createNew","src","tempNodes","nodesList","deleteLayer","isCanvas","images","evtobj","keyCode","ctrlKey","round","float","sign","lineSize","mX","mY","point","x","y","signX","signY","line","sX","sY","eX","eY","radius","beginPath","moveTo","lineTo","cX1","cY1","quadraticCurveTo","arc","PI","getColor","fillStyle","fill","strokeStyle","stroke"],"mappings":"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","file":"main-e3a9.js","sourcesContent":["var layers = [];\nvar num = 0;\nvar canvasId = \"#canvas\";\nvar wW = window.innerWidth;\nvar wH = window.innerHeight;\nvar nav = document.querySelector(\"nav\");\nvar intervalDraw;\nvar socket;\nvar hash = window.location.hash.substr(1);\n\nconst SPEED = 1;\nconst options = {\n  opacity: 0.6,\n  length: 120,\n  color: '0',\n  source: '1',\n  type: '3',\n  isDraw: true,\n  mousePress: false,\n  endLine: null\n};\noptions.sizeKoof = options.type === '3' ? 5 : 2;\n\n\nconst setColor = function(colorSelect) {\n  options.color = colorSelect.value;\n};\n\nconst setOpacity = function (slider) {\n  options.opacity = slider.value;\n};\n\nconst setLength = function (slider) {\n  options.length = slider.value;\n};\n\nconst setSource = function(selectObject) {\n  clearInterval(intervalDraw);\n\n  options.source = selectObject.value;\n  options.endLine = null;\n\n  if (options.source == '0') {\n    nav.classList.remove('mouse');\n    setDraw(false);\n  } else {\n    nav.classList.add('mouse');\n    setDraw(true);\n  }\n};\n\nconst setType = function(lineType) {\n  options.type = lineType.value;\n  options.endLine = null;\n  options.sizeKoof = (lineType.value === '3') ? 5 : 2;\n};\n\nconst setDraw = function(val) {\n  options.isDraw = val;\n  const canvas = document.getElementById(layers[layers.length - 1]);\n\n  if (document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = val;\n  }\n\n  if (val) {\n    nav.classList.add('active')\n\n    if (options.source === '0') {\n      intervalDraw = setInterval(function() {\n        drawCanvas(canvas)\n      }, Math.floor(Math.random() * (SPEED - (SPEED / 2) + (SPEED / 2)) * 100) / 100)\n    }\n  } else {\n    nav.classList.remove('active')\n    if (intervalDraw) {\n      clearInterval(intervalDraw);\n    }\n\n    if (hash) {\n      socket.emit('drawing', canvas.toDataURL());\n    }\n\n    addCanvas();\n  }\n};\n\nvar addCanvas = function() {\n  var wrapper = document.querySelector(\"#wrapper\");\n  var node = document.createElement(\"canvas\");\n\n  canvasId = \"canvas\" + num;\n  node.setAttribute(\"id\", canvasId);\n  wrapper.appendChild(node);\n\n  var canvas = document.getElementById(canvasId);\n  layers.push(canvasId);\n\n  if (layers.length > 1 && document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = false;\n  }\n  \n  canvasInit(canvas)\n\n  num++;\n};\n\nvar createCanvasByData = function(data, isHistory, isImport) {\n  var wrapper = document.querySelector(\"#wrapper\");\n  var node = document.createElement(\"canvas\");\n  \n  canvasId = \"canvas\" + num;\n  node.setAttribute(\"id\", canvasId);\n  if (isImport || isHistory) {\n    node.classList.add('temp');\n  }\n  wrapper.appendChild(node);\n  \n  var canvas = document.getElementById(canvasId);\n  layers.push(canvasId);\n  \n  if (layers.length > 1 && document.getElementById(\"undoBtn\")) {\n    document.getElementById(\"undoBtn\").disabled = false;\n  }\n  \n  canvasInit(canvas, data, isHistory)\n  \n  num++;\n};\n\nvar createImage = function(data, createNew) {\n  var wrapper = document.querySelector(\"#wrapper\");\n  var node = document.createElement(\"img\");\n  node.src = data;\n\n  const tempNodes = wrapper.querySelectorAll('canvas:not(.active)');\n  const nodesList = wrapper.querySelectorAll('canvas:not(.temp)');\n\n\n  if (createNew) {\n    nodesList.forEach(e => e.parentNode.removeChild(e));\n  } else {\n    tempNodes.forEach(e => e.parentNode.removeChild(e));\n  }\n\n  wrapper.appendChild(node);\n\n  if (createNew) {\n    addCanvas();\n  }\n};\n\nvar deleteLayer = function(isCanvas) {\n  if (isCanvas) {\n    var canvas = document.querySelector('canvas.active');\n    canvas.remove();\n\n    return;\n  }\n\n  var images = document.getElementById('wrapper').querySelectorAll('img');\n  images[0].parentNode.removeChild(images[images.length - 1]);\n  // lastImage.remove();\n\n  // node.remove();\n  //\n  // layers.splice(layers.length - 2 + (n ? n : 0), 1);\n  //\n  // if (layers.length < 2 && document.getElementById(\"undoBtn\")) {\n  //   document.getElementById(\"undoBtn\").disabled = true;\n  // }\n  //\n  // if(layers.length === 0) {\n  //   addCanvas();\n  // }\n};\n\nfunction clearAll() {\n  var wrapper = document.getElementById('wrapper');\n  wrapper.querySelectorAll('img').forEach(e => e.parentNode.removeChild(e))\n}\n\nwindow.addEventListener('keydown', function(e) {\n  var evtobj = window.event ? event : e\n\n  if (evtobj.keyCode == 90 && evtobj.ctrlKey) {\n\n    if (layers.length > 1) {\n      deleteLayer();\n    }\n  }\n});\n\nfunction debounce(func) {\n  var timer;\n\n  return function(event) {\n    if (timer) clearTimeout(timer);\n\n    timer = setTimeout(func, 300, event);\n  };\n}\n\nwindow.addEventListener(\"resize\", debounce(function() {\n  wW = window.innerWidth;\n  wH = window.innerHeight;\n\n  deleteLayer(true);\n  addCanvas();\n}));\n\nvar onDrawingEvent = function(data) {\n  createCanvasByData(data, false, true);\n};\n\nfunction httpGet(theUrl) {\n  var xmlHttp = new XMLHttpRequest();\n  xmlHttp.open( \"GET\", theUrl, false ); // false for synchronous request\n  xmlHttp.send( null );\n  return xmlHttp.responseText;\n}\n\nfunction startSocket(hash) {\n  socket = io.connect();\n  var room = 'room-' + hash;\n\n  socket.on('connect', function() {\n    socket.emit('room', room);\n  });\n\n  socket.on('drawing', onDrawingEvent);\n\n  const history = JSON.parse(httpGet('/history?room=' + room)).data;\n\n  if (history && history.length > 0) {\n    createCanvasByData(history, true);\n  }\n}\n\nfunction sharePano(link) {\n  function guid() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + s4();\n  }\n\n  const hash = guid();\n\n  link.href = window.location + '#' + hash\n}\n\nfunction init() {\n  wW = window.innerWidth;\n  wH = window.innerHeight;\n\n  if (hash) {\n    document.getElementById('clearBtn').remove();\n    document.getElementById('undoBtn').remove();\n    document.getElementById('shareBtn').remove();\n    startSocket(hash);\n  }\n\n  nav = document.querySelector(\"nav\");\n\n  addCanvas();\n}\n","const opacity = function(opacity) {\n  return opacity + Math.round(Math.random() * 0.4);\n};\n\nconst color = function(color) {\n  return (color === options.color) ? 220 : Math.round(Math.random() * ((options.color > 0 ? 100 : 150) - 10) + 10);\n};\n\nconst float = function () {\n  return Math.floor((Math.random() * 10) * (Math.random() < 0.5 ? -1 : 1));\n};\n\nconst sign = function() {\n  return (Math.random() < 0.5 ? -1 : 1);\n};\n\nconst lineSize = function() {\n  return Math.floor((Math.random() * options.length / options.sizeKoof));\n};\n\nfunction repeatOften(func) {\n  func\n  requestAnimationFrame(repeatOften);\n}\n\nconst drawCanvas = function(canvas, mX, mY, data) {\n  const ctx = canvas.getContext(\"2d\");\n  const point = data ? data.point : {\n    x: (mX && mY) ? mX + float() : Math.floor(Math.random() * (wW) * 100) / 100,\n    y: (mX && mY) ? mY + float() : Math.floor(Math.random() * (wH) * 100) / 100,\n  };\n  const signX = data ? data.signY : sign();\n  const signY = data ? data.signY : sign();\n  const line = data ? data.line : {\n    sX: point.x + lineSize() * signX,\n    sY: point.y + lineSize() * signY,\n    eX: point.x + lineSize() * -signX,\n    eY: point.y + lineSize() * -signY,\n  };\n  const type = data ? data.type : options.type;\n  const radius = data ? data.radius : lineSize(10);\n\n  ctx.beginPath();\n  ctx.moveTo(options.endLine ? options.endLine.x : line.sX, options.endLine ? options.endLine.y : line.sY);\n\n  if (type === '1') {\n    ctx.lineTo(line.eX, line.eY);\n  } else if (type === '2') {\n    line.cX1 = (line.sX + line.eX)/2 + Math.random() * 10 * signX;\n    line.cY1 = (line.sY + line.eY)/2 + Math.random() * 10 * -signY;\n\n    ctx.quadraticCurveTo(line.cX1,line.cY1,line.eX,line.eY);\n\n    options.endLine = {\n      x: line.eX,\n      y: line.eY,\n    }\n  } else {\n    ctx.arc(line.sX,line.sY,radius,0,2*Math.PI);\n  }\n\n  const getColor = data ? data.color : 'rgba(' + color('1') + ', ' + color('2') + ', ' + color('3') + ', ' + (opacity(options.opacity)) + ')';\n\n  if (type === '3') {\n    ctx.fillStyle = getColor;\n    ctx.fill()\n  } else {\n    ctx.strokeStyle = getColor;\n    ctx.stroke();\n  }\n\n  if (data) return null;\n\n  return {\n    type: options.type,\n    point,\n    line,\n    signX,\n    signY,\n    radius,\n    color: getColor\n  };\n};\n\nfunction mapData(canvas, data, isHistory) {\n  data.forEach((item, idx) => {\n    if (isHistory) {\n      drawCanvas(canvas, null, null, item)\n\n      if (idx === data.length -1) {\n        createImage(canvas.toDataURL());\n      }\n    } else {\n      repeatOften(setTimeout(function(){\n        drawCanvas(canvas, null, null, item)\n\n        if (idx === data.length -1) {\n          createImage(canvas.toDataURL());\n        }\n      }, 1000/60 * idx));\n    }\n  })\n}\n\nfunction canvasInit(canvas, data, isHistory) {\n  canvas.width = wW;\n  canvas.height = wH;\n  var dataList = [];\n\n  if (isHistory) {\n    data.forEach(item => {\n      dataList = dataList.concat(item)\n    });\n  }\n\n  if (canvas.getContext) {\n    var ctx = canvas.getContext(\"2d\");\n\n    ctx.lineWidth = 1;\n    ctx.lineJoin = ctx.lineCap = 'round';\n\n    if (data) {\n      mapData(canvas, isHistory ? dataList : data, isHistory);\n    } else {\n      canvas.classList.add('active');\n\n      const drawing = [];\n\n      canvas.moveOnCanvas = function(e) {\n        if (options.isDraw && (options.source === '2' || (options.source === '1' && canvas.mousePress))) {\n          if (intervalDraw) {\n            clearInterval(intervalDraw);\n          }\n          const res = drawCanvas(canvas, e.touches ? e.touches[0].pageX : e.pageX, e.touches ? e.touches[0].pageY : e.pageY)\n          if (res) {\n            drawing.push(res);\n          }\n        }\n      };\n\n      canvas.mouseDown = function(e) {\n        if (e.which === 1) {\n          canvas.mousePress = true;\n          if (options.isDraw && options.source === '1') {\n            intervalDraw = setInterval(function() {\n              const res = drawCanvas(canvas, e.touches ? e.touches[0].pageX : e.pageX, e.touches ? e.touches[0].pageY : e.pageY)\n              if (res) {\n                drawing.push(res);\n              }\n            }, Math.floor(Math.random() * (SPEED - (SPEED / 2) + (SPEED / 2)) * 100) / 5)\n          }\n        }\n      };\n      canvas.mouseUp = function() {\n        if (options.source === '2' || (options.source === '1')) {\n          options.endLine = null;\n          if (intervalDraw) {\n            clearInterval(intervalDraw);\n          }\n\n          if (canvas.mousePress) {\n            if (hash) {\n              socket.emit('drawing', drawing);\n            }\n\n            canvas.removeEventListener('mousedown', this, false);\n            canvas.removeEventListener('touchstart', this, false);\n            canvas.removeEventListener('mousemove', this, false);\n            canvas.removeEventListener('touchmove', this, false);\n            canvas.removeEventListener('mouseup', this, false);\n            canvas.removeEventListener('touchend', this, false);\n\n            createImage(canvas.toDataURL(), true);\n          }\n        }\n\n        canvas.mousePress = false;\n        ctx.restore();\n      };\n\n      canvas.addEventListener('mousedown', canvas.mouseDown);\n      canvas.addEventListener('touchstart', canvas.mouseDown);\n      canvas.addEventListener('mousemove', canvas.moveOnCanvas);\n      canvas.addEventListener('touchmove', canvas.moveOnCanvas);\n      canvas.addEventListener('mouseup', canvas.mouseUp);\n      canvas.addEventListener('touchend', canvas.mouseUp);\n    }\n  }\n}\n"]}