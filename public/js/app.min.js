"use strict";function clearAll(){for(var e=document.getElementById("wrapper");e.lastChild;)deleteCanvas();addCanvas()}function debounce(e){var n;return function(t){n&&clearTimeout(n),n=setTimeout(e,300,t)}}function httpGet(e){var n=new XMLHttpRequest;return n.open("GET",e,!1),n.send(null),n.responseText}function startSocket(e){socket=io.connect();var n="room-"+e;socket.on("connect",function(){socket.emit("room",n)}),socket.on("drawing",onDrawingEvent);var t=JSON.parse(httpGet("/history?room="+n)).data;t&&t.length>0&&t.forEach(function(e){createCanvasByData(e,!0)})}function sharePano(e){var n=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()}();e.href=window.location+"#"+n}function init(){wW=window.innerWidth,wH=window.innerHeight,hash&&(document.getElementById("clearBtn").remove(),document.getElementById("undoBtn").remove(),document.getElementById("shareBtn").remove(),startSocket(hash)),nav=document.querySelector("nav"),addCanvas()}function clearAll(){for(var e=document.getElementById("wrapper");e.lastChild;)deleteCanvas();addCanvas()}function debounce(e){var n;return function(t){n&&clearTimeout(n),n=setTimeout(e,300,t)}}function httpGet(e){var n=new XMLHttpRequest;return n.open("GET",e,!1),n.send(null),n.responseText}function startSocket(e){socket=io.connect();var n="room-"+e;socket.on("connect",function(){socket.emit("room",n)}),socket.on("drawing",onDrawingEvent);var t=JSON.parse(httpGet("/history?room="+n)).data;t&&t.length>0&&t.forEach(function(e){createCanvasByData(e,!0)})}function sharePano(e){var n=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()}();e.href=window.location+"#"+n}function init(){wW=window.innerWidth,wH=window.innerHeight,hash&&(document.getElementById("clearBtn").remove(),document.getElementById("undoBtn").remove(),document.getElementById("shareBtn").remove(),startSocket(hash)),nav=document.querySelector("nav"),addCanvas()}function repeatOften(e){requestAnimationFrame(repeatOften)}function canvasInit(e,n,t){if(e.width=wW,e.height=wH,e.getContext){var o=e.getContext("2d");if(o.lineWidth=1,o.lineJoin=o.lineCap="round",n)n.forEach(function(o,a){t?(drawCanvas(e,null,null,o),a===n.length-1&&createImage(e.toDataURL(),!0)):repeatOften(setTimeout(function(){drawCanvas(e,null,null,o),a===n.length-1&&createImage(e.toDataURL(),!0)},1e3/60))});else{e.classList.add("active");var a=[];e.moveOnCanvas=function(n){if(options.isDraw&&("2"===options.source||"1"===options.source&&e.mousePress)){intervalDraw&&clearInterval(intervalDraw);var t=drawCanvas(e,n.touches?n.touches[0].pageX:n.pageX,n.touches?n.touches[0].pageY:n.pageY);t&&a.push(t)}},e.mouseDown=function(n){1===n.which&&(e.mousePress=!0,options.isDraw&&"1"===options.source&&(intervalDraw=setInterval(function(){var t=drawCanvas(e,n.touches?n.touches[0].pageX:n.pageX,n.touches?n.touches[0].pageY:n.pageY);t&&a.push(t)},Math.floor(Math.random()*(SPEED-SPEED/2+SPEED/2)*100)/5)))},e.mouseUp=function(){"2"!==options.source&&"1"!==options.source||(options.endLine=null,intervalDraw&&clearInterval(intervalDraw),e.mousePress&&(hash&&socket.emit("drawing",a),e.removeEventListener("mousedown",this,!1),e.removeEventListener("touchstart",this,!1),e.removeEventListener("mousemove",this,!1),e.removeEventListener("touchmove",this,!1),e.removeEventListener("mouseup",this,!1),e.removeEventListener("touchend",this,!1),createImage(e.toDataURL(),!0,!0))),e.mousePress=!1,o.restore()},e.addEventListener("mousedown",e.mouseDown),e.addEventListener("touchstart",e.mouseDown),e.addEventListener("mousemove",e.moveOnCanvas),e.addEventListener("touchmove",e.moveOnCanvas),e.addEventListener("mouseup",e.mouseUp),e.addEventListener("touchend",e.mouseUp)}}}function repeatOften(e){requestAnimationFrame(repeatOften)}function canvasInit(e,n,t){if(e.width=wW,e.height=wH,e.getContext){var o=e.getContext("2d");if(o.lineWidth=1,o.lineJoin=o.lineCap="round",n)n.forEach(function(o,a){t?(drawCanvas(e,null,null,o),a===n.length-1&&createImage(e.toDataURL(),!0)):repeatOften(setTimeout(function(){drawCanvas(e,null,null,o),a===n.length-1&&createImage(e.toDataURL(),!0)},1e3/60))});else{e.classList.add("active");var a=[];e.moveOnCanvas=function(n){if(options.isDraw&&("2"===options.source||"1"===options.source&&e.mousePress)){intervalDraw&&clearInterval(intervalDraw);var t=drawCanvas(e,n.touches?n.touches[0].pageX:n.pageX,n.touches?n.touches[0].pageY:n.pageY);t&&a.push(t)}},e.mouseDown=function(n){1===n.which&&(e.mousePress=!0,options.isDraw&&"1"===options.source&&(intervalDraw=setInterval(function(){var t=drawCanvas(e,n.touches?n.touches[0].pageX:n.pageX,n.touches?n.touches[0].pageY:n.pageY);t&&a.push(t)},Math.floor(Math.random()*(SPEED-SPEED/2+SPEED/2)*100)/5)))},e.mouseUp=function(){"2"!==options.source&&"1"!==options.source||(options.endLine=null,intervalDraw&&clearInterval(intervalDraw),e.mousePress&&(hash&&socket.emit("drawing",a),e.removeEventListener("mousedown",this,!1),e.removeEventListener("touchstart",this,!1),e.removeEventListener("mousemove",this,!1),e.removeEventListener("touchmove",this,!1),e.removeEventListener("mouseup",this,!1),e.removeEventListener("touchend",this,!1),createImage(e.toDataURL(),!0,!0))),e.mousePress=!1,o.restore()},e.addEventListener("mousedown",e.mouseDown),e.addEventListener("touchstart",e.mouseDown),e.addEventListener("mousemove",e.moveOnCanvas),e.addEventListener("touchmove",e.moveOnCanvas),e.addEventListener("mouseup",e.mouseUp),e.addEventListener("touchend",e.mouseUp)}}}var layers=[],num=0,canvasId="#canvas",wW=window.innerWidth,wH=window.innerHeight,nav=document.querySelector("nav"),intervalDraw,socket,hash=window.location.hash.substr(1),SPEED=1,options={opacity:.6,length:120,color:"0",source:"1",type:"3",isDraw:!0,mousePress:!1,endLine:null};options.sizeKoof="3"===options.type?5:2;var setColor=function(e){options.color=e.value},setOpacity=function(e){options.opacity=e.value},setLength=function(e){options.length=e.value},setSource=function(e){clearInterval(intervalDraw),options.source=e.value,options.endLine=null,"0"==options.source?(nav.classList.remove("mouse"),setDraw(!1)):(nav.classList.add("mouse"),setDraw(!0))},setType=function(e){options.type=e.value,options.endLine=null,options.sizeKoof="3"===e.value?5:2},setDraw=function(e){options.isDraw=e;var n=document.getElementById(layers[layers.length-1]);document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=e),e?(nav.classList.add("active"),"0"===options.source&&(intervalDraw=setInterval(function(){drawCanvas(n)},Math.floor(Math.random()*(SPEED-SPEED/2+SPEED/2)*100)/100))):(nav.classList.remove("active"),intervalDraw&&clearInterval(intervalDraw),hash&&socket.emit("drawing",n.toDataURL()),addCanvas())},addCanvas=function(){var e=document.querySelector("#wrapper"),n=document.createElement("canvas");canvasId="canvas"+num,n.setAttribute("id",canvasId),e.appendChild(n);var t=document.getElementById(canvasId);layers.push(canvasId),layers.length>1&&document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=!1),canvasInit(t),num++},createCanvasByData=function(e,n){var t=document.querySelector("#wrapper"),o=document.createElement("canvas");canvasId="canvas"+num,o.setAttribute("id",canvasId),t.appendChild(o);var a=document.getElementById(canvasId);layers.push(canvasId),layers.length>1&&document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=!1),canvasInit(a,e,n),num++},createImage=function(e,n,t){var o=document.querySelector("#wrapper"),a=document.createElement("img");if(a.src=e,n){var r=o.querySelectorAll("canvas:not(.active)"),s=o.querySelector("canvas.active"),i=r[r.length-1];i?i.remove():s.remove()}o.appendChild(a),t&&addCanvas()},deleteCanvas=function(e){document.getElementById(layers[layers.length-2+(e||0)]).remove(),layers.splice(layers.length-2+(e||0),1),layers.length<2&&document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=!0),0===layers.length&&addCanvas()};window.addEventListener("keydown",function(e){var n=window.event?event:e;90==n.keyCode&&n.ctrlKey&&layers.length>1&&deleteCanvas()}),window.addEventListener("resize",debounce(function(){wW=window.innerWidth,wH=window.innerHeight,deleteCanvas(1),addCanvas()}));var onDrawingEvent=function(e){createCanvasByData(e,!1)},layers=[],num=0,canvasId="#canvas",wW=window.innerWidth,wH=window.innerHeight,nav=document.querySelector("nav"),intervalDraw,socket,hash=window.location.hash.substr(1),SPEED=1,options={opacity:.6,length:120,color:"0",source:"1",type:"3",isDraw:!0,mousePress:!1,endLine:null};options.sizeKoof="3"===options.type?5:2;var setColor=function(e){options.color=e.value},setOpacity=function(e){options.opacity=e.value},setLength=function(e){options.length=e.value},setSource=function(e){clearInterval(intervalDraw),options.source=e.value,options.endLine=null,"0"==options.source?(nav.classList.remove("mouse"),setDraw(!1)):(nav.classList.add("mouse"),setDraw(!0))},setType=function(e){options.type=e.value,options.endLine=null,options.sizeKoof="3"===e.value?5:2},setDraw=function(e){options.isDraw=e;var n=document.getElementById(layers[layers.length-1]);document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=e),e?(nav.classList.add("active"),"0"===options.source&&(intervalDraw=setInterval(function(){drawCanvas(n)},Math.floor(Math.random()*(SPEED-SPEED/2+SPEED/2)*100)/100))):(nav.classList.remove("active"),intervalDraw&&clearInterval(intervalDraw),hash&&socket.emit("drawing",n.toDataURL()),addCanvas())},addCanvas=function(){var e=document.querySelector("#wrapper"),n=document.createElement("canvas");canvasId="canvas"+num,n.setAttribute("id",canvasId),e.appendChild(n);var t=document.getElementById(canvasId);layers.push(canvasId),layers.length>1&&document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=!1),canvasInit(t),num++},createCanvasByData=function(e,n){var t=document.querySelector("#wrapper"),o=document.createElement("canvas");canvasId="canvas"+num,o.setAttribute("id",canvasId),t.appendChild(o);var a=document.getElementById(canvasId);layers.push(canvasId),layers.length>1&&document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=!1),canvasInit(a,e,n),num++},createImage=function(e,n,t){var o=document.querySelector("#wrapper"),a=document.createElement("img");if(a.src=e,n){var r=o.querySelectorAll("canvas:not(.active)"),s=o.querySelector("canvas.active"),i=r[r.length-1];i?i.remove():s.remove()}o.appendChild(a),t&&addCanvas()},deleteCanvas=function(e){document.getElementById(layers[layers.length-2+(e||0)]).remove(),layers.splice(layers.length-2+(e||0),1),layers.length<2&&document.getElementById("undoBtn")&&(document.getElementById("undoBtn").disabled=!0),0===layers.length&&addCanvas()};window.addEventListener("keydown",function(e){var n=window.event?event:e;90==n.keyCode&&n.ctrlKey&&layers.length>1&&deleteCanvas()}),window.addEventListener("resize",debounce(function(){wW=window.innerWidth,wH=window.innerHeight,deleteCanvas(1),addCanvas()}));var onDrawingEvent=function(e){createCanvasByData(e,!1)},opacity=function(e){return e+Math.round(.4*Math.random())},color=function(e){return e===options.color?220:Math.round(Math.random()*((options.color>0?100:150)-10)+10)},float=function(){return Math.floor(10*Math.random()*(Math.random()<.5?-1:1))},sign=function(){return Math.random()<.5?-1:1},lineSize=function(){return Math.floor(Math.random()*options.length/options.sizeKoof)},raf=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),drawCanvas=function(e,n,t,o){var a=e.getContext("2d"),r=o?o.point:{x:n&&t?n+float():Math.floor(Math.random()*wW*100)/100,y:n&&t?t+float():Math.floor(Math.random()*wH*100)/100},s=o?o.signY:sign(),i=o?o.signY:sign(),c=o?o.line:{sX:r.x+lineSize()*s,sY:r.y+lineSize()*i,eX:r.x+lineSize()*-s,eY:r.y+lineSize()*-i},u=o?o.type:options.type,d=o?o.radius:lineSize(10);a.beginPath(),a.moveTo(options.endLine?options.endLine.x:c.sX,options.endLine?options.endLine.y:c.sY),"1"===u?a.lineTo(c.eX,c.eY):"2"===u?(c.cX1=(c.sX+c.eX)/2+10*Math.random()*s,c.cY1=(c.sY+c.eY)/2+10*Math.random()*-i,a.quadraticCurveTo(c.cX1,c.cY1,c.eX,c.eY),options.endLine={x:c.eX,y:c.eY}):a.arc(c.sX,c.sY,d,0,2*Math.PI);var l=o?o.color:"rgba("+color("1")+", "+color("2")+", "+color("3")+", "+opacity(options.opacity)+")";return"3"===u?(a.fillStyle=l,a.fill()):(a.strokeStyle=l,a.stroke()),o?null:{type:options.type,point:r,line:c,signX:s,signY:i,radius:d,color:l}},opacity=function(e){return e+Math.round(.4*Math.random())},color=function(e){return e===options.color?220:Math.round(Math.random()*((options.color>0?100:150)-10)+10)},float=function(){return Math.floor(10*Math.random()*(Math.random()<.5?-1:1))},sign=function(){return Math.random()<.5?-1:1},lineSize=function(){return Math.floor(Math.random()*options.length/options.sizeKoof)},raf=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),drawCanvas=function(e,n,t,o){var a=e.getContext("2d"),r=o?o.point:{x:n&&t?n+float():Math.floor(Math.random()*wW*100)/100,y:n&&t?t+float():Math.floor(Math.random()*wH*100)/100},s=o?o.signY:sign(),i=o?o.signY:sign(),c=o?o.line:{sX:r.x+lineSize()*s,sY:r.y+lineSize()*i,eX:r.x+lineSize()*-s,eY:r.y+lineSize()*-i},u=o?o.type:options.type,d=o?o.radius:lineSize(10);a.beginPath(),a.moveTo(options.endLine?options.endLine.x:c.sX,options.endLine?options.endLine.y:c.sY),"1"===u?a.lineTo(c.eX,c.eY):"2"===u?(c.cX1=(c.sX+c.eX)/2+10*Math.random()*s,c.cY1=(c.sY+c.eY)/2+10*Math.random()*-i,a.quadraticCurveTo(c.cX1,c.cY1,c.eX,c.eY),options.endLine={x:c.eX,y:c.eY}):a.arc(c.sX,c.sY,d,0,2*Math.PI);var l=o?o.color:"rgba("+color("1")+", "+color("2")+", "+color("3")+", "+opacity(options.opacity)+")";return"3"===u?(a.fillStyle=l,a.fill()):(a.strokeStyle=l,a.stroke()),o?null:{type:options.type,point:r,line:c,signX:s,signY:i,radius:d,color:l}};
//# sourceMappingURL=app.min.js.map
